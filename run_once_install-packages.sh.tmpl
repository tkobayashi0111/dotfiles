#!/bin/sh
set -eu

{{ if .wsl -}}
# in WSL, integrate clipboard. require VcXsrc
if ! type xsel > /dev/null; then
  sudo apt update
  sudo apt install -y xsel
fi
{{- end }}

# install homebrew
if ! type brew > /dev/null; then
  yes "" | /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  {{- if eq .chezmoi.os "linux" }}
    BREW_PREFIX="/home/linuxbrew/.linuxbrew"
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
  {{- else if eq .chezmoi.os "darwin" }}
    {{- if eq .chezmoi.arch "arm64"}}
      BREW_PREFIX="/opt/homebrew"
    {{- else }}
      BREW_PREFIX="/usr/local"
    {{- end }}
  {{- end }}
  eval "$($BREW_PREFIX/bin/brew shellenv)"
fi

brew update
brew bundle --global

# install packer for neovim
if [ ! -e ~/.local/share/nvim/site/pack/packer ]; then
  git clone --depth 1 https://github.com/wbthomason/packer.nvim \
    ~/.local/share/nvim/site/pack/packer/start/packer.nvim
fi

# install tmux plugin manager
if [ ! -e ~/.tmux/plugins/tpm ]; then
  git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
fi
